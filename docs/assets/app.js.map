{"version":3,"file":"app.js","sources":["../../src/javascript/_misc.js","../../src/javascript/view/index.js","../../src/javascript/app.js"],"sourcesContent":["export default function () {\n\tlet doc = document;\n\n\t// UA marking\n\tconst UA_LIST = ['iPhone', 'iPad', 'MQQBrowser', 'Android', 'MicroMessenger', 'Trident'];\n\tlet ua = navigator.userAgent;\n\tlet $html = doc.getElementsByTagName('html')[0];\n\tfor (let i = 0; i < UA_LIST.length; i++) {\n\t\tvar uaRegExp = new RegExp(UA_LIST[i]);\n\t\t\n\t\tif (ua.match(uaRegExp)) {\n\t\t\t$html.classList.add('ua-' + UA_LIST[i]);\n\t\t}\n\t}\n\tif (ua.indexOf('Safari') !== -1 && ua.indexOf('Chrome') === -1) {\n\t\t$html.classList.add('ua-Safari');\n\t}\n\tif (!('ontouchstart' in window)) {\n\t\t$html.classList.add('ua-Pointer');\n\t}\n\n\t// Enable the CSS `:active` interactions\n\tdoc.getElementsByTagName('body')[0].addEventListener('touchstart', function(){}, {passive: true});\n\tdoc.getElementsByTagName('main')[0].addEventListener('touchstart', function(){}, {passive: true});\n\n\t// Twist HTML language\n\t// doc.getElementsByTagName('html')[0].setAttribute('lang', 'en');\n}\n","export default function () {\n\nlet doc = document;\nlet win = window;\n\n\n\n// Volume meter\n// Credit: https://github.com/cwilso/volume-meter/\nfunction createAudioMeter (audioContext, clipLevel, averaging, clipLag) {\n\tlet processor = audioContext.createScriptProcessor(1024);\n\t\n\tprocessor.clipping       = false;\n\tprocessor.lastClip       = 0;\n\tprocessor.volume         = 0;\n\tprocessor.clipLevel      = clipLevel || 0.98;\n\tprocessor.averaging      = averaging || 0.95;\n\tprocessor.clipLag        = clipLag || 750;\n\tprocessor.onaudioprocess = volumeAudioProcess;\n\t\n\t// this will have no effect, since we don't copy the input to the output,\n\t// but works around a current Chrome bug.\n\tprocessor.connect(audioContext.destination);\n\t\n\tprocessor.checkClipping = () => {\n\t\tif (!this.clipping)\n\t\t\treturn false;\n\t\tif ((this.lastClip + this.clipLag) < win.performance.now())\n\t\t\tthis.clipping = false;\n\t\treturn this.clipping;\n\t};\n\tprocessor.shutdown = () => {\n\t\tthis.disconnect();\n\t\tthis.onaudioprocess = null;\n\t};\n\t\n\treturn processor;\n}\nfunction volumeAudioProcess (event) {\n\tlet buf = event.inputBuffer.getChannelData(0);\n\tlet bufLength = buf.length;\n\tlet sum = 0;\n\tlet x;\n\t\n\tfor (let i = 0; i < bufLength; i++) {\n\t\tx = buf[i];\n\t\tif (Math.abs(x) >= this.clipLevel) {\n\t\t\tthis.clipping = true;\n\t\t\tthis.lastClip = win.performance.now();\n\t\t}\n\t\tsum += x * x;\n\t}\n\t\n\tvar rms = Math.sqrt(sum / bufLength);\n\tthis.volume = Math.max(rms, this.volume * this.averaging);\n\t\n\tconsole.log('test');\n\tconsole.log(rms, this.volume * this.averaging, this.volume);\n}\n\n\n\nlet audioContext;\nlet mediaStreamSource;\nlet meter;\n\nlet $inst = doc.querySelector('.instruction');\nlet $text = doc.querySelector('.text');\nlet textStyle = $text.style;\n\n$text.addEventListener('click', () => {\n\tif ($text.classList.contains('is-clicked')) {\n\t\treturn;\n\t} else {\n\t\t$text.classList.add('is-clicked');\n\t\t$inst.classList.add('is-clicked');\n\t}\n\t\n\twin.AudioContext = win.AudioContext || win.webkitAudioContext;\n\taudioContext = new AudioContext();\n\t\n\tif (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n\t\t// console.log('clicked');\n\t\tnavigator.mediaDevices.getUserMedia({\n\t\t\taudio: true\n\t\t}).then((stream) => {\n\t\t\tmediaStreamSource = audioContext.createMediaStreamSource(stream);\n\t\t\tmeter = createAudioMeter(audioContext);\n\t\t\tmediaStreamSource.connect(meter);\n\t\t\tconsole.log('4');\n\t\t\tupdateFVS();\n\t\t});\n\t}\n\t\n\t\n});\n\nlet updateFVS = () => {\n\tconsole.log(meter.volume);\n\tconst WDTH_LB = 50;\n\tconst WDTH_RATE = 5;\n\tconst SCALE_RATE = 5;\n\t// textStyle.fontVariationSettings = '\"wdth\"' + 50 * (1 + 2.5 * meter.volume);\n\ttextStyle.fontVariationSettings = '\"wdth\"' + WDTH_LB * (1 + WDTH_RATE * meter.volume);\n\ttextStyle.transform       = 'translateY(-50%) scale(' + (1 + SCALE_RATE * meter.volume) + ')';\n\ttextStyle.webkitTransform = 'translateY(-50%) scale(' + (1 + SCALE_RATE * meter.volume) + ')';\n\trequestAnimationFrame(updateFVS);\n};\n\n}\n","/*!\n * @license\n * Chris Wilson | MIT license | https://github.com/cwilso/volume-meter\n */\n\nlet doc = document;\n\n// Misc\nimport _misc from './_misc';\n_misc();\n\n// Class\n\n\n\n// View\nimport viewIndex   from './view/index';\n\n// View router\nlet view = doc.querySelector('body').classList[0];\n\nswitch (view) {\n\tcase 'index': {\n\t\tviewIndex();\n\t\tbreak;\n\t}\n}\n"],"names":["doc","document","UA_LIST","ua","navigator","userAgent","$html","getElementsByTagName","i","length","uaRegExp","RegExp","match","classList","add","indexOf","window","addEventListener","passive","win","createAudioMeter","audioContext","clipLevel","averaging","clipLag","processor","createScriptProcessor","clipping","lastClip","volume","onaudioprocess","volumeAudioProcess","connect","destination","checkClipping","performance","now","shutdown","disconnect","event","buf","inputBuffer","getChannelData","bufLength","sum","x","Math","abs","rms","sqrt","max","console","log","mediaStreamSource","meter","$inst","querySelector","$text","textStyle","style","contains","AudioContext","webkitAudioContext","mediaDevices","getUserMedia","audio","then","stream","createMediaStreamSource","updateFVS","WDTH_LB","WDTH_RATE","SCALE_RATE","fontVariationSettings","transform","webkitTransform","requestAnimationFrame","_misc","view","viewIndex"],"mappings":"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"}